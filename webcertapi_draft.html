<!DOCTYPE html>
<html>
<head>
<title>Web Certificate API Specification</title>
<meta http-equiv='Content-Type' content='text/html;charset=utf-8' />
<script src='http://www.w3.org/Tools/respec/respec-w3c-common' class='remove' async></script>
<script class='remove'>
      var respecConfig = {
          // document info
          specStatus:           "ED",
          shortName:            "webcertapi",
          // publishDate:   "2013-03-29",
          // previousMaturity: "WD",
          // previousPublishDate:  "2009-03-15",
          // previousURI : "http://dev.w3.org/2009/dap/ReSpec.js/documentation.html",
          copyrightStart:       "2013",
          edDraftURI:           "http://mountielee.github.com/webcertapi/webcertapi_draft.html",
          // lcEnd:  "2010-08-06",
          // extraCSS:             ["../css/respec.css"],
          extraCSS:             ["http://dev.w3.org/2009/dap/ReSpec.js/css/respec.css"],

          // editors
          editors:  [
              { name: "Mountie Lee", url: "",
                company: "PayGate", companyURL: "http://www.paygate.net/" },
              { name: "Sangrae Cho", url: "",
                company: "ETRI", companyURL: "http://www.etri.or.kr/" },
          ],
          
          // WG
          wg:           "Web Cryptography Working Group",
          wgURI:        "http://www.w3.org/2012/webcrypto/",
          wgPublicList: "",
          wgPatentURI:  "",
      };
    </script>
</head>
<body>
        <section id='abstract'>
		the Web Certificate API is the specification for Web Certificate Management Protocol based on RFC-4210,
		control of TLS session and derivation of keys from TLS sessions
	</section>

	<section id='sotd'>
		<p>the table of contents are defined by Working Group Charter and email comments.</p>
		<p>definition of WebIDL will be added after getting consensus for table of contents.</p>
	</section>

	<section>
		<h2>Certificate Lifecycle Control</h2>
		<p>the web certificate api based on the certificate management protocol follows by RFC4210. </p>
		<p>this specification focus on user agent side of RFC4210 CMP</P>
		<section class='informative'>
			<h3>Overview</h3>
			<p>the specification is trying to keep existing RA/CA services with minor changes</p>
			<p>Web Certificate API defines the request and response parameters and processed between user agent and RA/CA service providers</p>
			<img src=cert_overview.PNG />
		</section>	
		<section class='informative'>
			<h3>CertMessage interface</h3>
			<p>CertMessage is the object that will contain a return value when the request of cmp is generated. The message contained in this object is sent to CA server for certificate oepration.</p>
		<div class="block">
		<pre class="code"><code class="idl-code">
Interface CertMessage { 
        readonly attribute any msgType;
        readonly attribute any msgID;
        readonly attribute any message:
};

msgType - this indicates which certificate oepation is contained in this message.
msgID - identifier that identify any related messages during oepration
message - text based message that is encoded according to msgType
        </code></pre>
        	</div>
        	        
		</section>	
		<section>
			<h3>CertResult interface</h3>
			<p>CertResult is the object that will contain a return value when the response of cmp is received from a CA Server. This object contains the result of CA operation that is requested by UA.</p>
		<pre class="code">
			<code class="idl-code">
Interface CertResult { 
	readonly attribute any status;
	readonly attribute any msgID;
	readonly attribute any certificate:
};

status - this indicates the result of CA operation requested by UA.
msgID - identifier that identify any related messages during oepration
certificate - a certificate that is issued or updated by CA server
			</code>
		</pre>
		</section>	
		<section class='informative'>
			<h3>Cert interface</h3>
			<p>Cert is the object that requests a certificate operation to CA server and handles a response message from the server.</p>
		<pre class="code">
			<code class="idl-code">
enum ReqType {
	// RFC 4210 Certificate Management Protocol.
	"cmp",
	// Certificate Management protocol using CMS.
	"cmc",
	// PKCS#10 type Certificate signing request.
	"pkcs10",
};


Interface Cert {
	CertMessage requestCert (ReqType reqType, KeySpec keySpec, DOMString refCode, DOMString authKey);
	CertMessage updateCert (ReqType reqType, KeySpec keySpec, DOMString certID, DOMString keyPass);
	CertMessage revokeCert (ReqType reqType, DOMString certID, DOMString keyPass);
	CertResult handleResp (CertMessage certMessage);
	CertMessage genConfirm (DOMString msgID, DOMString certID, DOMString keyPass);
}
			</code>
		</pre>
			<section>
				<h4>Methods and Parameters</h4>
				<section>
					<h5>The requestCert method</h5>
					<p>This method allows UA to request a certificate to CA. This method returns base64 encoded ASN.1 encoded initial request message if cmp is used.</p>
					<pre class="code">
Input parameters:

ReqType - { "cmp", "cmsc", "pkcs10", …}
keySpec - keyAlgorithm, keyLength, keyParameter, priKey, pubKey "	priKey and pubKey should be null if key is generated in genCertReq
authKey - initial authentication key for origin of message
refCode - reference code to identify a user to request certificate

Return value:

CertMessage - this can be ASN.1 encoded initial request message if CMP is used.
					</pre>
				</section>
				<section>
					<h5>The updateCert method</h5>
					<p>This method allows UA to renew a certificate to CA. This method returns ASN.1 encoded initial request message if cmp is used.</p>
					<pre class="code">
Input parameters:

ReqType - { "cmp", "cmsc", "pkcs10", …}
keySpec - keyAlgorithm, keyLength, keyParameter, priKey, pubKey "	priKey and pubKey should be null if key is generated in updateCertReq
certID - identifier to locate a issued certificate and related private key in a storage
keyPass - a password to decrypt an encrypted private key
Return value:

CertMessage - this can be ASN.1 encoded key update request message if CMP is used.
					</pre>
				</section>
				<section>
					<h5>The revokeCert method</h5>
					<p>This method allows UA to renew a certificate to CA. This method returns ASN.1 encoded initial request message if cmp is used.</p>
					<pre class="code">
Input parameters:

ReqType - { "cmp", "cmsc", "pkcs10", …}
certID - identifier to locate a certificate and private key in a storage
keyPass - a password to decrypt a encrypted private key
Return value:

CertMessage - this can be ASN.1 encoded key revocation request message if CMP is used.

					</pre>
				</section>
				<section>
					<h5>The handleResp method</h5>
					<p>This method handles a response message sent from CA Server.</p>
					<pre class="code">
Input parameters:

CertMessage - this can be ASN.1 encoded response message sent from CA server if CMP is used.
Return value:

CertResult - this is the result of cert oepration carried out in CA server.

					</pre>
				</section>
				<section>
					<h5>The genConfirm method</h5>
					<p>This method generates confirmation message required in CMP protocol sending to CA server that confirms certificate operation is successfully finished. This method is optional since some type of certificate management is not needed</p>
					<pre class="code">
Input parameters:

msgID - message identifier that this message confirms
certID - identifier to locate a certificate and private key in a storage
keyPass - a password to decrypt a encrypted private key
Return value:

CertMessage - this can be ASN.1 encoded key revocation request message if CMP is used.					</pre>
				</section>
			</section>
		</section>	
	</section>

	<section>
		<h2>Certificate Validation</h2>
		<p>certificate validation is added on to public key verification.</p>
		<section>
			<h3>Certificate Chain Validation</h3>
			<p>certificate chain validation validate certificate chains up to the trusted RootCA.</p>
		</section>
		<section>
			<h3>Certificate CRL Validation</h3>
			<p>when validating certificate, certificate revocation list will be optionally checked.
			<section>
				<h4>CRL Distribution Point</h4>
				<p>when the full CRL size is too big to download on low speed network environment, CRLDP can be used for effective CRL checking.</p>
			</section>
		</section>
		<section>
			<h3>Certificate OCSP Validation</h3>
			<p>Online Certificate Status Protocol(OCSP) can be optionally used to validate certificate.</p>
		</section>
	</section>

	<section>
		<h2>Data Structures</h2>
		<section>
			<h3>JOSE and CMS</h3>
		</section>
		<section>
			<h3>Common Data Structures of CMP</h3>
		</section>
	</section>
	<section>
		<h2>Security Considerations</h2>
		<section>
			<h3>Same-Origin Policy</h3>
			<p>Same Origin Policy is base security policy of WebCrypto API</p>
			<p>to keep the backward compatibility, some conditional exceptions are required but it does not mean the multiple connections to multiple origins</p> 
			<p>the exceptions are only for accessing private keys that is binded to some origin initiated from different origin when the faired certificate is valid</p>
			<p>the exceptions of same-origin policy can be allowed by following conditions</p>
			<ul>
				<li>private key access binded to valid certificate
				<li>the certificate issued by valid CA
				<li>the CA is listed in trusted CA list of user agent
			</ul>
		</section>
		<section>
			<h3>Certificate KeyStorage</h3>
			<p>Certificate KeyStorage should be interoperable with existing TLS Key Storage</p>
			<p>to keep the backward compatibility, when the certificate is installed into user agent, it will be listed in TLS Key Storage of user agent</p>
			<p>but the certificate operations will be restricted by the KeyUsage defined in certificate inside.</p>
			<p>when the certificate and private key pair is inserted via PKCS#11 interface into TLS Key Storage, it also can be used by webcrypto API with valid KeyUsage</p>
		</section>
	</section>
</body>
</html>

